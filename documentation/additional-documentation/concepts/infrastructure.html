<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>ndb-core documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../../images/favicon.ico">
	   <link rel="stylesheet" href="../../styles/style.css">
        <link rel="stylesheet" href="../../styles/dark.css">
    </head>
    <body>
          <script>
               // Blocking script to avoid flickering dark mode
               // Dark mode toggle button
               var useDark = window.matchMedia('(prefers-color-scheme: dark)');
               var darkModeState = useDark.matches;
               var $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               var $darkModeToggles = document.querySelectorAll('.dark-mode-switch');
               var darkModeStateLocal = localStorage.getItem('compodoc_darkmode-state');

               function checkToggle(check) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].checked = check;
                    }
               }

               function toggleDarkMode(state) {
                    if (window.localStorage) {
                         localStorage.setItem('compodoc_darkmode-state', state);
                    }

                    checkToggle(state);

                    const hasClass = document.body.classList.contains('dark');

                    if (state) {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.add('dark');
                         }
                         if (!hasClass) {
                              document.body.classList.add('dark');
                         }
                    } else {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.remove('dark');
                         }
                         if (hasClass) {
                              document.body.classList.remove('dark');
                         }
                    }
               }

               useDark.addEventListener('change', function (evt) {
                    toggleDarkMode(evt.matches);
               });
               if (darkModeStateLocal) {
                    darkModeState = darkModeStateLocal === 'true';
               }
               toggleDarkMode(darkModeState);
          </script>
          <script>
              // --- Iframe navigation tracking for Template Playground ---
              function sendCurrentUrlToParent() {
                  if (window.parent && window.parent !== window) {
                      window.parent.postMessage({
                          type: 'compodoc-iframe-navigate',
                          url: window.location.pathname + window.location.hash
                      }, '*');
                  }
              }
              window.addEventListener('hashchange', sendCurrentUrlToParent, false);
              window.addEventListener('popstate', sendCurrentUrlToParent, false);
              window.addEventListener('DOMContentLoaded', sendCurrentUrlToParent, false);
          </script>

        <div class="navbar navbar-default navbar-fixed-top d-md-none p-0">
               <div class="d-flex">
                    <a href="../../" class="navbar-brand">ndb-core documentation</a>
                    <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
               </div>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="d-none d-md-block menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content additional-page">
                   <div class="content-data">

























<h1>Infrastructure</h1>
<p>Aam Digital is an Angular application and can be deployed on a simple webserver.
To do so we are using Docker and some other tools.</p>
<p>The following diagram show the actions that are performed when new code changes are published.</p>
<p><img src="../../images/CICD-Flow.svg" alt="CI/CD Flow" class="img-responsive"></p>
<h2>Dockerfile</h2>
<p>The Dockerfile can be found in <a href="https://github.com/Aam-Digital/ndb-core/blob/master/build/Dockerfile">/build/Dockerfile</a>.
It provides a stable environment where the application is build, tested and packaged.
It consists of two stages.
The first stage is build on top of a <code>node</code> image and builds the application for production usage and optionally runs tests and uploads the test coverage.
The second stage is build on top of a <code>nginx</code> image and only copies the files from the previous stage, which are necessary for deploying the application.
This process makes the final image as small as possible.
<code>nginx</code> is used to run a lightweight webserver.
The configuration for <code>nginx</code> can be found in <a href="https://github.com/Aam-Digital/ndb-core/blob/master/build/default.conf">/build/default.conf</a>.</p>
<h2>Pull Requests</h2>
<p>Whenever a new pull request is created, GitHub creates a new app on Heroku and posts the link to this app in the PR.
For each new commit of a PR, GitHub then builds the Docker image for this branch.
This includes building the application in production mode, linting the sourcecode and running the tests.
If all these stages pass, GitHub will upload the newly created image to Heroku.
Once this is done, a version of Aam Digital with the new changes included can be visited through the posted link.</p>
<h2>Master Updates</h2>
<p>After approving a PR and merging it into the master, semantic release automatically creates a new tag for this change.
For each new tag a tagged Docker image is uploaded to <a href="https://hub.docker.com/r/aamdigital/ndb-server">DockerHub</a>.</p>
<h2>Deploying Aam Digital</h2>
<p>The Docker image from DockerHub can then be downloaded and run via Docker using the following command:</p>
<blockquote>
<p>docker pull aamdigital/ndb-server &amp;&amp; docker run -p=80:80 aamdigital/ndb-server</p>
</blockquote>
<p>However, this will only run Aam Digital in demo-mode.
To run Aam Digital with a real database, a new <code>config.json</code> file has to be mounted into the image.
This should have a structure equal to <code>config.default.json</code> (<a href="https://github.com/Aam-Digital/ndb-core/blob/master/src/assets/config.default.json">/src/assets/config.default.json</a>).
It holds the information about where to find the remote database, what the name of the app is and in which mode the app is being run.</p>
<p>The <a href="https://github.com/Aam-Digital/ndb-setup">ndb-setup</a> project provides a clear workflow for how to deploy a new instance of Aam Digital and CouchDB.
It extends the Docker image with a <code>docker-compose.yml</code> file which handles all the dependencies.
For further information checkout the <a href="https://github.com/Aam-Digital/ndb-setup/blob/master/README.md">README</a>.</p>

                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 2;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'additional-page';
            var COMPODOC_CURRENT_PAGE_URL = 'infrastructure.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script>
               $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               checkToggle(darkModeState);
               if ($darkModeToggleSwitchers.length > 0) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].addEventListener('change', function (event) {
                              darkModeState = !darkModeState;
                              toggleDarkMode(darkModeState);
                         });
                    }
               }
          </script>

       <script src="../../js/libs/custom-elements.min.js"></script>
       <script src="../../js/libs/lit-html.js"></script>

       <script src="../../js/menu-wc.js" defer></script>
       <script nomodule src="../../js/menu-wc_es5.js" defer></script>

       <script src="../../js/libs/bootstrap-native.js"></script>

       <script src="../../js/libs/es6-shim.min.js"></script>
       <script src="../../js/libs/EventDispatcher.js"></script>
       <script src="../../js/libs/promise.min.js"></script>

       <script src="../../js/compodoc.js"></script>

       <script src="../../js/tabs.js"></script>
       <script src="../../js/menu.js"></script>
       <script src="../../js/libs/clipboard.min.js"></script>
       <script src="../../js/libs/prism.js"></script>
       <script src="../../js/sourceCode.js"></script>
          <script src="../../js/search/search.js"></script>
          <script src="../../js/search/lunr.min.js"></script>
          <script src="../../js/search/search-lunr.js"></script>
          <script src="../../js/search/search_index.js"></script>
       <script src="../../js/lazy-load-graphs.js"></script>


    </body>
</html>
