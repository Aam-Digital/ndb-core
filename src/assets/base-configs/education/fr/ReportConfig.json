[
  {
    "_id": "ReportConfig:basic-report",
    "title": "Rapport de base",
    "aggregationDefinitions": [
      {
        "query": "Child:toArray[*isActive=true]",
        "label": "Tous les enfants",
        "groupBy": [
          "gender"
        ]
      },
      {
        "query": "School:toArray",
        "label": "Toutes les écoles",
        "aggregations": [
          {
            "label": "Enfants fréquentant une école",
            "query": ":getRelated(ChildSchoolRelation, schoolId)[*isActive=true].childId:unique"
          },
          {
            "label": "Écoles publiques",
            "query": "[*privateSchool!=true]"
          },
          {
            "query": "[*privateSchool!=true]:getRelated(ChildSchoolRelation, schoolId)[*isActive=true].childId::unique:toEntities(Child)",
            "label": "Enfants fréquentant une école publique",
            "groupBy": [
              "gender"
            ]
          },
          {
            "label": "Écoles privées",
            "query": "[*privateSchool=true]"
          },
          {
            "query": "[*privateSchool=true]:getRelated(ChildSchoolRelation, schoolId)[*isActive=true].childId::unique:toEntities(Child)",
            "label": "Enfants fréquentant une école privée",
            "groupBy": [
              "gender"
            ]
          }
        ]
      }
    ]
  },
  {
    "_id": "ReportConfig:event-report",
    "title": "Rapport d'événement",
    "aggregationDefinitions": [
      {
        "query": "EventNote:toArray[*date >= ? & date <= ?]",
        "groupBy": [
          "category"
        ],
        "label": "Événements",
        "aggregations": [
          {
            "query": ":getParticipantsWithAttendance(PRESENT):unique:toEntities(Child)",
            "groupBy": [
              "gender"
            ],
            "label": "Participants"
          }
        ]
      }
    ]
  },
  {
    "_id": "ReportConfig:attendance-report",
    "title": "Rapport de présence",
    "mode": "exporting",
    "aggregationDefinitions": [
      {
        "query": "EventNote:toArray[* date >= ? & date <= ?]",
        "groupBy": {
          "label": "Type",
          "property": "category"
        },
        "subQueries": [
          {
            "query": ":getAttendanceArray:getAttendanceReport",
            "subQueries": [
              {
                "label": "Nom",
                "query": ".participant:toEntities(Child).name"
              },
              {
                "query": ".participant:toEntities(Child):getRelated(ChildSchoolRelation, childId)[*isActive=true]",
                "subQueries": [
                  {
                    "label": "Classe",
                    "query": ".schoolClass"
                  },
                  {
                    "label": "École",
                    "query": ".schoolId:toEntities(School).name"
                  }
                ]
              },
              {
                "label": "Total",
                "query": "total"
              },
              {
                "label": "Présent",
                "query": "present"
              },
              {
                "label": "Taux",
                "query": "percentage"
              },
              {
                "label": "Retard",
                "query": "detailedStatus.LATE"
              }
            ]
          }
        ]
      }
    ]
  },
  {
    "_id": "ReportConfig:materials-distributed",
    "title": "Matériels distribués",
    "mode": "exporting",
    "aggregationDefinitions": [
      {
        "query": "EducationalMaterial:toArray[*date >= ? & date <= ?]",
        "groupBy": {
          "label": "Type",
          "property": "materialType"
        },
        "subQueries": [
          {
            "label": "Nombre d'événements de distribution",
            "query": ".materialAmount:count"
          },
          {
            "label": "Total d'articles",
            "query": ".materialAmount:sum"
          }
        ]
      }
    ]
  }
]
