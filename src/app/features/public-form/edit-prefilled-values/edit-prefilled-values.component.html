<p i18n class="padding-regular">
  You can configure some fields to be always be set to a certain value when this
  form is submitted. For example, make a "status" field always be set to "new"
  so that you can easily filter the new records submitted by external users; or
  make a "signed up on" date field to always show the current date. If you add
  the same field(s) in the "Configure Fields" section to show to the user, this
  pre-filled value can be changed by the person filling the form.
</p>

<div
  class="defaultvalue-container padding-regular"
  [class.disabled]="formControl.disabled"
>
  <form [formGroup]="prefilledValueSettings">
    <div formArrayName="prefilledValue">
      <div
        *ngFor="let fieldGroup of prefilledValues.controls; let i = index"
        [formGroupName]="i"
        class="flex-row flex-wrap align-center gap-regular padding-regular margin-top-regular mat-elevation-z2 container"
      >
        <div class="flex-row align-center">
          <mat-form-field class="full-width-field">
            <mat-label i18n>Field</mat-label>
            <app-entity-field-select
              [entityType]="entityConstructor"
              formControlName="field"
            />
          </mat-form-field>
          <app-help-button
            text="Select a field for which you want to set a default value."
            i18n-text
          ></app-help-button>
        </div>
        @if (fieldGroup.get("field").value) {
          <div class="flex-grow">
            <div class="full-width-field">
              <app-admin-default-value
                formControlName="defaultValue"
                [entityType]="entityConstructor"
                [entitySchemaField]="
                  getSchemaField(fieldGroup.get('field').value)
                "
              ></app-admin-default-value>
            </div>
          </div>
        }

        <button
          mat-icon-button
          (click)="removePrefilledFields(i)"
          matTooltip="Remove default value"
          i18n-matTooltip
        >
          <fa-icon icon="trash"></fa-icon>
        </button>
      </div>
    </div>
  </form>

  <div class="add-new-defaultvalue-field">
    <button
      mat-stroked-button
      class="add-new-defaultvalue-button"
      color="accent"
      (click)="addPrefilledFields()"
      [disabled]="prefilledValues.invalid"
      matTooltip="Add a fixed value for another field"
      i18n-matTooltip
    >
      <fa-icon
        aria-label="add element"
        icon="plus-circle"
        class="standard-icon-with-text"
      ></fa-icon>
      <span i18n>Add pre-filled value</span>
    </button>
  </div>

  <div class="margin-top-large">
    <h3 i18n>Collect replies of this form linked to individual records</h3>
    <p i18n>
      You can use this option to automatically link form submissions to a
      specific participant (like a child or school) using a URL parameter. This
      is useful for feedback forms, where the participant should not choose
      themselves.
    </p>

    <mat-form-field>
      <mat-label i18n>Linked to</mat-label>
      <mat-select [formControl]="linkedEntityFieldControl">
        <mat-option *ngFor="let field of relatedRefFields" [value]="field.id">
          {{ field.label }}
        </mat-option>
      </mat-select>
    </mat-form-field>
  </div>
</div>
