<div class="flex-column gap-small">
  <mat-select
    [value]="selectedOption"
    (valueChange)="onOptionSelected($event)"
    [placeholder]="getSelectedOptionLabel() || 'Select inheritance option'"
  >
    <div
      class="select-dropdown-header"
      matTooltip="Configure how this field should inherit its value from related records"
      i18n-matTooltip
      i18n
    >
      Default Value
    </div>

    @if (availableOptions.length > 0) {
      @for (option of availableOptions; track option) {
        <mat-option [value]="option" [matTooltip]="option.tooltip">
          <div class="flex-row gap-small align-items-center">
            {{ option.label }}
          </div>
        </mat-option>
      }
    } @else {
      <mat-option disabled>
        <em i18n>No inheritance options available</em>
      </mat-option>
    }
  </mat-select>

  <!-- Secondary dropdown for inherited field selection (only shown for inheritance type) -->
  @if (selectedOption?.type === "inherit" && currentInheritanceFields) {
    <mat-select
      [value]="value?.sourceValueField"
      (valueChange)="onInheritedFieldSelected($event)"
      placeholder="Select field to inherit from"
    >
      <div
        class="select-dropdown-header"
        matTooltip="The field of the linked record from which the value is copied into this field."
        i18n-matTooltip
        i18n
      >
        Inherited field of linked record:
      </div>
      @for (field of currentInheritanceFields?.availableFields; track field) {
        <mat-option [value]="field">
          <app-entity-field-label
            [field]="field"
            [entityType]="currentInheritanceFields?.referencedEntityType"
          ></app-entity-field-label>
        </mat-option>
      }
    </mat-select>
  }

  <!-- Configure mapping button (shown for automated rules) -->
  @if (selectedOption?.type === "automated" && value?.sourceEntityType) {
    <button
      mat-raised-button
      class="margin-top-small"
      (click)="openAutomatedMappingDialog(value.sourceEntityType)"
      matTooltip="Optionally configure a value mapping, defining how the source value should be transformed."
      i18n-matTooltip
      i18n
    >
      Configure Mapping
    </button>
  }
</div>
