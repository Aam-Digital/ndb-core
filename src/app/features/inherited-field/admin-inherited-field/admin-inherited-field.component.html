<div class="flex-row gap-small">
  <mat-select
    [value]="selectedOption"
    (valueChange)="onOptionSelected($event)"
    [placeholder]="getSelectedOptionLabel() || 'Select inheritance option'"
  >
    @for (option of availableOptions; track option) {
      <mat-option [value]="option" [matTooltip]="option.tooltip">
        <div class="flex-row gap-small align-items-center">
          @if (option.labelParts.isInheritance) {
            <!-- inheritance: field > entity -->
            <span>{{ option.labelParts.fieldName }}</span>
            <span> > </span>
            <span style="font-weight: bold" class="text-primary">{{
              option.labelParts.entityName
            }}</span>
          } @else {
            <!-- automation: entity > field -->
            <span style="font-weight: bold" class="text-primary">{{
              option.labelParts.entityName
            }}</span>
            <span> > </span>
            <span>{{ option.labelParts.fieldName }}</span>
          }
        </div>
      </mat-option>
    } @empty {
      <mat-option disabled>
        <em i18n>No inheritance options available</em>
      </mat-option>
    }
  </mat-select>

  @if (selectedOption?.type === "inherit" && currentInheritanceFields) {
    <mat-select
      [value]="value?.sourceValueField"
      (valueChange)="onInheritedFieldSelected($event)"
      placeholder="Select field to inherit from"
      i18n-placeholder
    >
      <div
        class="select-dropdown-header"
        matTooltip="The field of the linked record from which the value is copied into this field."
        i18n-matTooltip
        i18n
      >
        Inherited field of linked record:
      </div>
      @for (field of currentInheritanceFields?.availableFields; track field) {
        <mat-option [value]="field">
          <app-entity-field-label
            [field]="field"
            [entityType]="currentInheritanceFields?.referencedEntityType"
          ></app-entity-field-label>
        </mat-option>
      }
    </mat-select>
  }

  @if (selectedOption?.type === "automated" && value?.sourceEntityType) {
    <button
      mat-stroked-button
      class="configure-button"
      (click)="openAutomatedMappingDialog(value.sourceEntityType)"
      matTooltip="Optionally configure a value mapping, defining how the source value should be transformed."
      i18n-matTooltip
      i18n
    >
      Configure Mapping
    </button>
  }
</div>
