<button
  mat-icon-button
  matTooltip="Notifications"
  i18n-matTooltip
  [matMenuTriggerFor]="data"
  (menuOpened)="onNotificationBellClick()"
>
  <span
    [matBadge]="allNotifications.length > 0 ? allNotifications.length : null"
    matBadgeColor="accent"
  >
    <fa-icon class="white" icon="bell"></fa-icon>
  </span>
</button>

<mat-menu #data>
  <div class="notification-panel">
    <div class="flex-row justify-space-between align-center notification-panel-header">
      <h1 class="notification-title">Notifications</h1>

      <button
        mat-icon-button
        [matMenuTriggerFor]="settingsMenu"
        (click)="$event.stopPropagation()"
        *ngIf="!showSettings"
        icon-button
      >
        <fa-icon icon="ellipsis"></fa-icon>
      </button>

      <div
        *ngIf="showSettings"
        (click)="$event.stopPropagation()"
        class="notification-toggle-button"
      >
        <mat-slide-toggle
          [(ngModel)]="isEnableNotification"
          (click)="$event.stopPropagation()"
          icon-button
          matTooltip="Your Notification is active"
          i18n-matTooltip
        />
      </div>
    </div>

    <!-- Tabs -->
    <mat-tab-group
      [(selectedIndex)]="selectedTab"
      (click)="$event.stopPropagation()"
    >
      <mat-tab label="All"></mat-tab>
      <mat-tab label="Unread"></mat-tab>
    </mat-tab-group>

    <ng-container *ngIf="selectedTab === 0">
      <!-- All Notifications -->
        <app-notification-item
          *ngFor="let notification of allNotifications"
          [notification]="notification"
          [onMarkAsRead]="markAsRead"
          [onDeleteNotification]="deleteNotification"
        ></app-notification-item>
      <div
        class="no-notification-message"
        *ngIf="allNotifications.length === 0"
      >
        <fa-icon class="no-notification-icon" icon="bell"></fa-icon>
        <span class="no-notification-text">You have no notifications</span>
      </div>
    </ng-container>

    <ng-container *ngIf="selectedTab === 1">
      <app-notification-item
        *ngFor="let notification of allNotifications"
        [notification]="notification"
        [onMarkAsRead]="markAsRead"
        [onDeleteNotification]="deleteNotification"
      ></app-notification-item>
      <div
        class="no-notification-message"
        *ngIf="unreadNotifications.length === 0"
      >
        <fa-icon class="no-notification-icon" icon="bell"></fa-icon>
        <span class="no-notification-text">You have no notifications</span>
      </div>
    </ng-container>
  </div>
</mat-menu>

<!-- New mat-menu for ellipsis -->
<mat-menu #settingsMenu>
  <button mat-menu-item (click)="markAllRead()">
    <fa-icon icon="check"></fa-icon>
    <span class="menu-option">Mark all as read</span>
  </button>
  <button mat-menu-item (click)="markAllUnread()">
    <fa-icon icon="gear"></fa-icon>
    <span class="menu-option">Notification settings</span>
  </button>
</mat-menu>
