<mat-expansion-panel class="padding-regular">
  <mat-expansion-panel-header style="height: fit-content">
    <h2 i18n>Match Settings</h2>
  </mat-expansion-panel-header>

  <div class="flex-column gap-regular">
    <div
      class="flex-row align-baseline gap-regular margin-right-large full-width"
    >
      <p i18n>
        Configure the details of the record that is created as a match. (e.g. A
        "school enrollment" record that is created upon matching a student with
        a school).
      </p>
    </div>

    <form [formGroup]="form">
      <div class="flex-row">
        <mat-form-field class="full-width">
          <mat-label i18n>Record created as a match:</mat-label>
          <mat-select
            formControlName="newEntityType"
            (selectionChange)="onEntityTypeChange($event.value)"
          >
            @for (
              relatedEntity of availableRelatedEntities;
              track relatedEntity
            ) {
              <mat-option [value]="relatedEntity.entityType">
                {{ relatedEntity.label }}
              </mat-option>
            }
          </mat-select>
        </mat-form-field>
      </div>

      <div class="flex-row gap-regular margin-top-regular">
        <mat-form-field class="full-width">
          <mat-label i18n>Left Match Property</mat-label>
          <app-entity-field-select
            [entityType]="entityConstructor"
            formControlName="newEntityMatchPropertyLeft"
            [hideOption]="hideLeftOption"
          ></app-entity-field-select>
        </mat-form-field>
        <app-help-button
          i18n-text
          text="Select the field from the entity that will be used as the left-side key in matching comparison."
        ></app-help-button>

        <mat-form-field class="full-width">
          <mat-label i18n>Right Match Property</mat-label>
          <app-entity-field-select
            [entityType]="entityConstructor"
            formControlName="newEntityMatchPropertyRight"
            [hideOption]="hideRightOption"
          ></app-entity-field-select>
        </mat-form-field>
        <app-help-button
          i18n-text
          text="Select the field from the entity that will be used as the right-side key in matching comparison."
        ></app-help-button>
      </div>

      <span i18n
        >Fields shown in dialog for confirmation or editing when creating a
        match:</span
      >
      <app-entity-fields-menu
        [entityType]="entityConstructor"
        [availableFields]="availableFields"
        [activeFields]="fieldsAsStrings"
        (activeFieldsChange)="activeFields = $event"
      ></app-entity-fields-menu>
    </form>
  </div>
</mat-expansion-panel>
