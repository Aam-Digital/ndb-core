<!--Search-->
<input
  [hidden]="!focused"
  #inputElement
  [formControl]="autocompleteForm"
  matInput
  style="text-overflow: ellipsis"
  [matAutocomplete]="autoSuggestions"
  (focusout)="onFocusOut($event)"
/>

<!--Display-->
<!-- for some reason background color is working with inline styling only  -->
<mat-chip
  *ngIf="displayText && isChipHidden"
  style="background-color: transparent;"
  class="chip">
    <input
    [hidden]="focused"
    [disabled]="_disabled"
    matInput
    [style]="{textOverflow: 'ellipsis', width: (displayText ? displayText.length : 'auto') + 'ch'}"
    (focusin)="showAutocomplete()"
    (focusout)="showAutocomplete()"
    [value]="displayText"
  />
</mat-chip>

<mat-autocomplete
  [disableRipple]="true"
  #autoSuggestions="matAutocomplete"
  (optionSelected)="select($event.option.value)"
  autoActiveFirstOption
  [hideSingleSelectionIndicator]="multi"
>
  <mat-option
    *ngFor="let item of autocompleteSuggestedOptions | async"
    [value]="item"
  >
    <mat-checkbox *ngIf="multi" [checked]="item.selected"></mat-checkbox>
    <ng-container *ngIf="!templateRef; else useTemplate">{{
      item.asString
    }}</ng-container>
    <ng-template
      #useTemplate
      [ngTemplateOutlet]="templateRef"
      [ngTemplateOutletContext]="{ $implicit: item.initial }"
    ></ng-template>
  </mat-option>
  <mat-option
    *ngIf="createOption && showAddOption && inputElement.value"
    [value]="inputElement.value"
  >
    <em
      i18n="
        Label for adding an option in a dropdown|e.g. Add option My new Option
      "
      >Add option</em
    >
    {{ inputElement.value }}
  </mat-option>
</mat-autocomplete>
