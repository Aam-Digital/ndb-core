<div class="conditional-color-config">
  <div class="flex-row gap-regular align-center">
    <app-color-input
      [color]="staticColor"
      (colorChange)="onStaticColorChange($event)"
    ></app-color-input>

    @if (isConditionalMode) {
      <button
        mat-stroked-button
        type="button"
        color="primary"
        (click)="removeConditionalMode()"
      >
        <span i18n>Remove conditional colors</span>
      </button>
    } @else {
      <button mat-stroked-button type="button" (click)="addConditionalMode()">
        <span i18n>Add conditional colors</span>
      </button>
    }
  </div>

  @if (isConditionalMode) {
    <div class="conditional-section flex-column gap-regular padding-regular">
      <div class="margin-bottom-regular">
        <label class="mat-body-2" i18n>Conditional Color</label>
        <app-color-input
          [color]="conditionalColor"
          (colorChange)="onConditionalColorChange($event)"
        ></app-color-input>
      </div>

      <div class="rules-list flex-column gap-small padding-regular">
        @for (condition of conditionalMappings; track $index) {
          <div class="rule-item">
            <div class="flex-row gap-regular align-center">
              <mat-form-field class="flex-grow">
                <mat-label i18n>Condition Field</mat-label>
                <mat-select
                  [value]="getConditionField(condition)"
                  (valueChange)="onConditionFieldChange($index, $event)"
                >
                  @for (option of colorFieldOptions; track option.value) {
                    <mat-option [value]="option.value">{{
                      option.label
                    }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>

              @if (conditionFormFieldConfigs.get($index)) {
                <mat-form-field class="flex-grow" floatLabel="always">
                  <mat-label>{{
                    conditionFormFieldConfigs.get($index).label
                  }}</mat-label>
                  <app-dynamic-edit
                    [formFieldConfig]="conditionFormFieldConfigs.get($index)"
                    [formControl]="conditionFormControls.get($index)"
                  ></app-dynamic-edit>
                </mat-form-field>
              }

              <button
                mat-icon-button
                type="button"
                color="warn"
                (click)="deleteRule($index)"
                matTooltip="Delete condition"
                i18n-matTooltip
              >
                <fa-icon icon="trash"></fa-icon>
              </button>
            </div>
          </div>
        }

        <div class="buttons-container flex-column gap-small margin-top-small">
          <button mat-stroked-button type="button" (click)="addNewRule()">
            <fa-icon icon="plus" class="standard-icon-with-text"></fa-icon>
            <span i18n>Add Condition</span>
          </button>

          <button
            mat-stroked-button
            type="button"
            (click)="openFullJsonEditor()"
          >
            <fa-icon icon="code" class="standard-icon-with-text"></fa-icon>
            <span i18n>Edit Condition JSON</span>
          </button>
        </div>
      </div>
    </div>
  }
</div>
