<h1>System Settings</h1>

<mat-accordion class="admin-sections margin-top-large" multi>
  <!-- Subscription Section -->
  @if (isSaasEnvironment) {
    <mat-expansion-panel
      [expanded]="isExpanded('subscription')"
      (opened)="setExpanded('subscription')"
    >
      <mat-expansion-panel-header>
        <mat-panel-title i18n>Subscription</mat-panel-title>
        <mat-panel-description i18n
          >Manage your subscription details, privacy settings, and access to
          advanced features.</mat-panel-description
        >
      </mat-expansion-panel-header>
      <mat-nav-list class="section-nav-list">
        <mat-list-item [routerLink]="['/admin/subscription-info']">
          <span matListItemTitle i18n>Subscription Info</span>
        </mat-list-item>
        <mat-list-item [routerLink]="['/admin/advanced-features']">
          <span matListItemTitle i18n>Advanced Features</span>
        </mat-list-item>
        <mat-list-item [routerLink]="['/admin/data-privacy']">
          <span matListItemTitle i18n>Data Privacy</span>
        </mat-list-item>
      </mat-nav-list>
    </mat-expansion-panel>
  }

  <!-- Configuration and Site Wide Settings Section -->
  <mat-expansion-panel
    [expanded]="isExpanded('config')"
    (opened)="setExpanded('config')"
  >
    <mat-expansion-panel-header>
      <mat-panel-title i18n
        >Configuration and Site Wide Settings</mat-panel-title
      >
      <mat-panel-description i18n
        >Set up the essential elements that shape your site's structure and
        system behaviour.</mat-panel-description
      >
    </mat-expansion-panel-header>
    <mat-nav-list class="section-nav-list">
      @for (item of configurationMenuItems; track item.label) {
        @if (item.link) {
          <mat-list-item
            [routerLink]="[item.link]"
            [matTooltip]="item.subtitle ?? ''"
            [matTooltipDisabled]="!item.subtitle"
            matTooltipPosition="before"
          >
            <span matListItemTitle>{{ item.label }}</span>
          </mat-list-item>
        }
      }
    </mat-nav-list>
  </mat-expansion-panel>

  <!-- Templates and Forms Section (items dynamic) -->
  <mat-expansion-panel
    [expanded]="isExpanded('templates')"
    (opened)="setExpanded('templates')"
  >
    <mat-expansion-panel-header>
      <mat-panel-title i18n>Templates and Forms</mat-panel-title>
      <mat-panel-description i18n
        >Customise your templates and forms.</mat-panel-description
      >
    </mat-expansion-panel-header>
    @if (templates.length > 0) {
      <mat-nav-list class="section-nav-list">
        @for (item of templates; track item.label) {
          @if (item.link) {
            <mat-list-item
              [routerLink]="[item.link]"
              [matTooltip]="item.subtitle ?? ''"
              [matTooltipDisabled]="!item.subtitle"
              matTooltipPosition="before"
            >
              <span matListItemTitle>{{ item.label }}</span>
            </mat-list-item>
          }
        }
      </mat-nav-list>
    }
  </mat-expansion-panel>

  <!-- User Management Section -->
  <mat-expansion-panel
    [expanded]="isExpanded('user-management')"
    (opened)="setExpanded('user-management')"
  >
    <mat-expansion-panel-header>
      <mat-panel-title i18n>User Management</mat-panel-title>
      <mat-panel-description i18n
        >Set up and manage user accounts, roles, and
        permissions.</mat-panel-description
      >
    </mat-expansion-panel-header>
    <mat-nav-list class="section-nav-list">
      <mat-list-item
        [routerLink]="['/admin/user-list']"
        matTooltip="Create, edit and manage user accounts."
        i18n-matTooltip
        matTooltipPosition="before"
      >
        <span matListItemTitle i18n>User Accounts</span>
      </mat-list-item>
      <mat-list-item
        [routerLink]="['/admin/user-roles']"
        matTooltip="Set roles and manage role-based access."
        i18n-matTooltip
        matTooltipPosition="before"
      >
        <span matListItemTitle i18n>User Roles & Permissions</span>
      </mat-list-item>
    </mat-nav-list>
  </mat-expansion-panel>

  <!-- Export and Backups Section (special content) -->
  <mat-expansion-panel
    [expanded]="isExpanded('export')"
    (opened)="setExpanded('export')"
  >
    <mat-expansion-panel-header>
      <mat-panel-title i18n>Export and Backups</mat-panel-title>
      <mat-panel-description i18n
        >Define how your system keeps data protected and
        accessible.</mat-panel-description
      >
    </mat-expansion-panel-header>
    <mat-nav-list class="section-nav-list">
      <mat-list-item
        (click)="saveBackup()"
        button
        matTooltip="Download all data of the database."
        i18n-matTooltip
        matTooltipPosition="before"
      >
        <span matListItemTitle i18n>Download Backup (.json)</span>
      </mat-list-item>
      <mat-list-item
        (click)="backupImport.click()"
        button
        matTooltip="Upload a previous backup to restore the database to that state."
        i18n-matTooltip
        matTooltipPosition="before"
      >
        <span matListItemTitle i18n>Restore Backup (.json)</span>
      </mat-list-item>
      <mat-list-item
        (click)="saveCsvExport()"
        button
        matTooltip="Download all data of the database in a format that can be opened as a spreadsheet."
        i18n-matTooltip
        matTooltipPosition="before"
      >
        <span matListItemTitle i18n>Full Database Export (.csv)</span>
      </mat-list-item>
    </mat-nav-list>
    <input #backupImport type="file" hidden (change)="loadBackup($event)" />
  </mat-expansion-panel>

  <!-- Technical Administration Section (special content) -->
  <mat-expansion-panel
    [expanded]="isExpanded('technical')"
    (opened)="setExpanded('technical')"
  >
    <mat-expansion-panel-header>
      <mat-panel-title i18n>Technical Administration</mat-panel-title>
      <mat-panel-description i18n
        >Manage advanced technical options for maintaining and troubleshooting
        your system.</mat-panel-description
      >
    </mat-expansion-panel-header>
    <mat-nav-list class="section-nav-list">
      <mat-list-item
        (click)="editConfig()"
        button
        matTooltip="Open the raw configuration file to make advanced technical adjustments."
        i18n-matTooltip
        matTooltipPosition="before"
      >
        <span matListItemTitle i18n>Edit Application Configuration (JSON)</span>
      </mat-list-item>
      <mat-list-item
        (click)="downloadConfigClick()"
        button
        matTooltip="Download the raw configuration file."
        i18n-matTooltip
        matTooltipPosition="before"
      >
        <span matListItemTitle i18n
          >Download Application Configuration (JSON)</span
        >
      </mat-list-item>
      <mat-list-item
        (click)="configImport.click()"
        button
        matTooltip="Upload a raw configuration file and overwrite the current system configuration."
        i18n-matTooltip
        matTooltipPosition="before"
      >
        <span matListItemTitle i18n
          >Upload Application Configuration (JSON)</span
        >
      </mat-list-item>
      <mat-list-item
        (click)="debugDatabase()"
        button
        matTooltip="Make the database service available in the browser's developer console for advanced administrative tasks."
        i18n-matTooltip
        matTooltipPosition="before"
      >
        <span matListItemTitle i18n>PouchDB Debug: Send to console.log()</span>
      </mat-list-item>
      <mat-list-item
        (click)="clearDatabase()"
        button
        matTooltip="Delete all data in the database."
        i18n-matTooltip
        matTooltipPosition="before"
      >
        <span matListItemTitle i18n>Empty Database</span>
      </mat-list-item>
      <mat-list-item
        [routerLink]="['/admin/conflicts']"
        matTooltip="View any database records that could not be synced because multiple users edited the record at the same time while offline."
        i18n-matTooltip
        matTooltipPosition="before"
      >
        <span matListItemTitle i18n>Database Conflicts</span>
      </mat-list-item>
    </mat-nav-list>
    <input
      #configImport
      type="file"
      hidden
      (change)="uploadConfigFile($event)"
    />
  </mat-expansion-panel>
</mat-accordion>
