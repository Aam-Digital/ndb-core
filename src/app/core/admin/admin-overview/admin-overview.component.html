<h1>Administration & Configuration</h1>

<p style="font-weight: bold; font-style: italic">
  Warning: This section is intended for system administrators only. Make sure
  you know what you are doing.
</p>

<mat-accordion class="admin-sections" multi>
  @for (section of adminOverviewService.sections; track section.id) {
    <!-- Hide subscription section if not in SaaS environment -->
    @if (section.id !== "subscription" || isSaasEnvironment()) {
      <mat-expansion-panel
        [expanded]="section.expanded"
        (expandedChange)="onSectionExpandedChange(section.id, $event)"
      >
        <mat-expansion-panel-header>
          <mat-panel-title>{{ section.title }}</mat-panel-title>
          <mat-panel-description>
            {{ section.description }}
          </mat-panel-description>
        </mat-expansion-panel-header>

        <!-- Dynamic section items -->
        @if (section.items.length > 0) {
          <mat-nav-list class="section-nav-list">
            @for (item of section.items; track item.link) {
              <mat-list-item [routerLink]="[item.link]">
                <span matListItemTitle>{{ item.label }}</span>
              </mat-list-item>
            }
          </mat-nav-list>
        }

        <!-- Special content for Export and Backups section -->
        @if (section.id === "export-backups") {
          <mat-nav-list class="section-nav-list">
            <mat-list-item (click)="saveBackup()" button>
              <span matListItemTitle>Download Backup (.json)</span>
            </mat-list-item>
            <mat-list-item (click)="backupImport.click()" button>
              <span matListItemTitle>Restore Backup (.json)</span>
            </mat-list-item>
            <mat-list-item (click)="saveCsvExport()" button>
              <span matListItemTitle>Full Database Export (.csv)</span>
            </mat-list-item>
          </mat-nav-list>
          <input
            #backupImport
            type="file"
            hidden
            (change)="loadBackup($event)"
          />
        }

        <!-- Special content for Technical Administration section -->
        @if (section.id === "technical") {
          <mat-nav-list class="section-nav-list">
            <mat-list-item (click)="editConfig()" button>
              <span matListItemTitle
                >Edit Application Configuration (JSON)</span
              >
            </mat-list-item>
            <mat-list-item (click)="downloadConfigClick()" button>
              <span matListItemTitle
                >Download Application Configuration (JSON)</span
              >
            </mat-list-item>
            <mat-list-item (click)="configImport.click()" button>
              <span matListItemTitle
                >Upload Application Configuration (JSON)</span
              >
            </mat-list-item>
            <mat-list-item (click)="editPermissions()" button>
              <span matListItemTitle
                >Edit Permissions Configuration (JSON)</span
              >
            </mat-list-item>
            <mat-list-item (click)="debugDatabase()" button>
              <span matListItemTitle
                >PouchDB Debug: Send to console.log()</span
              >
            </mat-list-item>
            <mat-list-item (click)="clearDatabase()" button>
              <span matListItemTitle>Empty Database</span>
            </mat-list-item>
            <mat-list-item routerLink="config-import">
              <span matListItemTitle
                >Generate Configuration from Spreadsheet</span
              >
            </mat-list-item>
          </mat-nav-list>

          <input
            #configImport
            type="file"
            hidden
            (change)="uploadConfigFile($event)"
          />
        }
      </mat-expansion-panel>
    }
  }
</mat-accordion>
