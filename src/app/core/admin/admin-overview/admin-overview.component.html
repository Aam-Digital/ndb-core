<h1>System Settings</h1>

<mat-accordion class="admin-sections margin-top-large" multi>
  <!-- Subscription Section -->
  @if (isSaasEnvironment) {
    <mat-expansion-panel
      [expanded]="isExpanded('subscription')"
      (opened)="setExpanded('subscription')"
    >
      <mat-expansion-panel-header>
        <mat-panel-title i18n>Subscription</mat-panel-title>
        <mat-panel-description i18n
          >Manage your subscription details, privacy settings, and access to
          advanced features.</mat-panel-description
        >
      </mat-expansion-panel-header>
      <mat-nav-list class="section-nav-list">
        <mat-list-item [routerLink]="['/admin/subscription-info']">
          <span matListItemTitle i18n>Subscription Info</span>
        </mat-list-item>
        <mat-list-item [routerLink]="['/admin/advanced-features']">
          <span matListItemTitle i18n>Advanced Features</span>
        </mat-list-item>
        <mat-list-item [routerLink]="['/admin/data-privacy']">
          <span matListItemTitle i18n>Data Privacy</span>
        </mat-list-item>
      </mat-nav-list>
    </mat-expansion-panel>
  }

  <!-- Configuration and Site Wide Settings Section -->
  <mat-expansion-panel
    [expanded]="isExpanded('config')"
    (opened)="setExpanded('config')"
  >
    <mat-expansion-panel-header>
      <mat-panel-title i18n
        >Configuration and Site Wide Settings</mat-panel-title
      >
      <mat-panel-description i18n
        >Set up the essential elements that shape your site's structure and
        system behaviour.</mat-panel-description
      >
    </mat-expansion-panel-header>
    <mat-nav-list class="section-nav-list">
      @for (item of configurationMenuItems; track item.label) {
        @if (item.link) {
          <mat-list-item
            [routerLink]="[item.link]"
            [matTooltip]="item.subtitle ?? ''"
            [matTooltipDisabled]="!item.subtitle"
            matTooltipPositionAtOrigin
          >
            <span matListItemTitle>{{ item.label }}</span>
          </mat-list-item>
        }
      }
    </mat-nav-list>
  </mat-expansion-panel>

  <!-- Templates and Forms Section (items dynamic) -->
  <mat-expansion-panel
    [expanded]="isExpanded('templates')"
    (opened)="setExpanded('templates')"
  >
    <mat-expansion-panel-header>
      <mat-panel-title i18n>Templates and Forms</mat-panel-title>
      <mat-panel-description i18n
        >Customise your templates and forms.</mat-panel-description
      >
    </mat-expansion-panel-header>
    @if (templates.length > 0) {
      <mat-nav-list class="section-nav-list">
        @for (item of templates; track item.label) {
          @if (item.link) {
            <mat-list-item
              [routerLink]="[item.link]"
              [matTooltip]="item.subtitle ?? ''"
              [matTooltipDisabled]="!item.subtitle"
              matTooltipPosition="before"
            >
              <span matListItemTitle>{{ item.label }}</span>
            </mat-list-item>
          }
        }
      </mat-nav-list>
    }
  </mat-expansion-panel>

  <!-- User Management Section -->
  <mat-expansion-panel
    [expanded]="isExpanded('user-management')"
    (opened)="setExpanded('user-management')"
  >
    <mat-expansion-panel-header>
      <mat-panel-title i18n>User Management</mat-panel-title>
      <mat-panel-description i18n
        >Set up and manage user accounts, roles, and
        permissions.</mat-panel-description
      >
    </mat-expansion-panel-header>
    <mat-nav-list class="section-nav-list">
      <mat-list-item [routerLink]="['/admin/user-list']">
        <span matListItemTitle i18n>User Accounts</span>
        <span matListItemLine i18n>Create, edit and manage user accounts.</span>
      </mat-list-item>
      <mat-list-item [routerLink]="['/admin/user-roles']">
        <span matListItemTitle i18n>User Roles & Permissions</span>
        <span matListItemLine i18n
          >Set roles and manage role-based access.</span
        >
      </mat-list-item>
    </mat-nav-list>
  </mat-expansion-panel>

  <!-- Export and Backups Section (special content) -->
  <mat-expansion-panel
    [expanded]="isExpanded('export')"
    (opened)="setExpanded('export')"
  >
    <mat-expansion-panel-header>
      <mat-panel-title i18n>Export and Backups</mat-panel-title>
      <mat-panel-description i18n
        >Define how your system keeps data protected and
        accessible.</mat-panel-description
      >
    </mat-expansion-panel-header>
    <mat-nav-list class="section-nav-list">
      <mat-list-item (click)="saveBackup()" button>
        <span matListItemTitle i18n>Download Backup (.json)</span>
        <span matListItemLine i18n>Download all data of the database.</span>
      </mat-list-item>
      <mat-list-item (click)="backupImport.click()" button>
        <span matListItemTitle i18n>Restore Backup (.json)</span>
        <span matListItemLine i18n
          >Upload a previous backup to restore the database to that state.</span
        >
      </mat-list-item>
      <mat-list-item (click)="saveCsvExport()" button>
        <span matListItemTitle i18n>Full Database Export (.csv)</span>
        <span matListItemLine i18n
          >Download all data of the database in a format that can be opened as a
          spreadsheet.</span
        >
      </mat-list-item>
    </mat-nav-list>
    <input #backupImport type="file" hidden (change)="loadBackup($event)" />
  </mat-expansion-panel>

  <!-- Technical Administration Section (special content) -->
  <mat-expansion-panel
    [expanded]="isExpanded('technical')"
    (opened)="setExpanded('technical')"
  >
    <mat-expansion-panel-header>
      <mat-panel-title i18n>Technical Administration</mat-panel-title>
      <mat-panel-description i18n
        >Manage advanced technical options for maintaining and troubleshooting
        your system.</mat-panel-description
      >
    </mat-expansion-panel-header>
    <mat-nav-list class="section-nav-list">
      <mat-list-item (click)="editConfig()" button>
        <span matListItemTitle i18n>Edit Application Configuration (JSON)</span>
        <span matListItemLine i18n
          >Open the raw configuration file to make advanced technical
          adjustments.</span
        >
      </mat-list-item>
      <mat-list-item (click)="downloadConfigClick()" button>
        <span matListItemTitle i18n
          >Download Application Configuration (JSON)</span
        >
        <span matListItemLine i18n>Download the raw configuration file.</span>
      </mat-list-item>
      <mat-list-item (click)="configImport.click()" button>
        <span matListItemTitle i18n
          >Upload Application Configuration (JSON)</span
        >
        <span matListItemLine i18n
          >Upload a raw configuration file and overwrite the current system
          configuration.</span
        >
      </mat-list-item>
      <mat-list-item (click)="debugDatabase()" button>
        <span matListItemTitle i18n>PouchDB Debug: Send to console.log()</span>
        <span matListItemLine i18n
          >Make the database service available in the browser's developer
          console for advanced administrative tasks.</span
        >
      </mat-list-item>
      <mat-list-item (click)="clearDatabase()" button>
        <span matListItemTitle i18n>Empty Database</span>
        <span matListItemLine i18n>Delete all data in the database.</span>
      </mat-list-item>
      <mat-list-item [routerLink]="['/admin/conflicts']">
        <span matListItemTitle i18n>Database Conflicts</span>
        <span matListItemLine i18n
          >View any database records that could not be synced because multiple
          users edited the record at the same time while offline.</span
        >
      </mat-list-item>
    </mat-nav-list>
    <input
      #configImport
      type="file"
      hidden
      (change)="uploadConfigFile($event)"
    />
  </mat-expansion-panel>
</mat-accordion>
