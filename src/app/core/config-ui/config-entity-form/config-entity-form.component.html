<div cdkDropListGroup class="overall-container flex-row">
  <!-- FORM PREVIEW -->
  <div class="flex-grow admin-grid-layout padding-right-regular">
    <!-- FIELD GROUPS -->
    <div
      *ngFor="let group of fieldGroups; let i = index"
      class="entity-form-cell admin-form-column"
    >
      <!-- GROUP HEADER -->
      <div class="flex-row align-baseline">
        <mat-form-field floatLabel="always">
          <mat-label>Group Title</mat-label>
          <input matInput [(ngModel)]="group.header" placeholder="(no title)" />
        </mat-form-field>

        <button
          (click)="removeGroup(i)"
          mat-icon-button
          matTooltip="Remove this group and all its fields"
          i18n-matTooltip
          class="group-remove-button"
        >
          <fa-icon icon="times"></fa-icon>
        </button>
      </div>

      <div
        cdkDropList
        [cdkDropListData]="group.fields"
        (cdkDropListDropped)="drop($event)"
        class="fields-group-list drop-list"
      >
        <!-- FIELD [start] -->
        <div
          *ngFor="let f of group.fields"
          class="admin-form-field flex-row align-center"
          cdkDrag
          cdkDragBoundary=".overall-container"
        >
          <fa-icon
            icon="grip-vertical"
            size="xl"
            class="drag-handle"
            cdkDragHandle
          ></fa-icon>

          <button
            mat-stroked-button
            color="accent"
            class="field-edit-button"
            (click)="openFieldConfig(f, group.fields)"
          >
            Edit Field
          </button>

          <div class="dummy-form-field">
            <div [class.field-with-tooltip-suffix]="f.tooltip">
              <ng-container
                *ngIf="f.id"
                [appDynamicComponent]="{
                  component: f.edit,
                  config: {
                    formFieldConfig: f,
                    propertySchema: entityType.schema.get(f.id),
                    formControl: dummyForm.get(f.id),
                    entity: dummyEntity
                  }
                }"
              >
              </ng-container>
            </div>
            <app-help-button [text]="f.tooltip"></app-help-button>
          </div>
        </div>
        <!-- FIELD [end]-->
      </div>
    </div>

    <!-- DROP AREA: NEW FIELD GROUP -->
    <div class="entity-form-cell admin-form-column">
      <div
        cdkDropList
        (cdkDropListDropped)="dropNewGroup($event)"
        class="fields-group-list drop-list drop-area-hint"
      >
        drop here to create new field group
        <fa-icon
          icon="question-circle"
          matTooltip="You can group fields so that they will always appear next to each other while the layout is automatically adjusted to different screen sizes. Such field groups can also have a title displayed to users."
          i18n-matTooltip
        ></fa-icon>
      </div>
    </div>
  </div>

  <!-- TOOLBAR -->
  <mat-card class="toolbar">
    <mat-card-content
      cdkDropList
      (cdkDropListDropped)="drop($event)"
      [cdkDropListData]="availableFields"
      class="drop-list"
    >
      <div class="drop-area-hint">
        <em>hidden fields</em><br />
        drag & drop to / from here
        <fa-icon
          icon="question-circle"
          matTooltip="You can remove fields from the form without deleting them completely. The fields here will not be visible or editable for users but you can display them in other views or keep them archived to not lose previously collected data. Drag a field back into the form preview to reactivate it."
          i18n-matTooltip
        ></fa-icon>
      </div>

      <div
        *ngFor="let f of availableFields"
        class="admin-form-field flex-row align-center"
        [class.admin-form-field-new]="!f.id"
        cdkDrag
        cdkDragBoundary="mat-drawer-container"
      >
        <fa-icon
          icon="grip-vertical"
          size="xl"
          class="drag-handle"
          cdkDragHandle
        ></fa-icon>

        <div>
          {{ f.label }}
          <button
            *ngIf="f.id"
            mat-stroked-button
            color="accent"
            class="field-edit-button field-edit-button-small"
            (click)="openFieldConfig(f, availableFields)"
          >
            Edit
          </button>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</div>
