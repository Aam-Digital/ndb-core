<div class="flex-row gap-small">
  <app-basic-autocomplete
    #autocomplete
    (click)="onContainerClick($event)"
    class="flex-grow"
    display="chips"
    [formControl]="formControl()"
    [valueMapper]="entityToId"
    [optionToString]="accessor"
    (autocompleteFilterChange)="recalculateMatchingInactive($event)"
    [multi]="multi"
    [options]="availableOptionsResource.value()"
    [placeholder]="loading() ? loadingPlaceholder : placeholder"
    [createOption]="isCreateDisabled() ? null : createNewEntity"
  >
    <ng-template let-item>
      @if (!item.isHidden) {
        <app-entity-block
          style="margin: auto"
          [entity]="item"
          [linkDisabled]="formControl().enabled"
        ></app-entity-block>
      }
    </ng-template>

    @if (currentlyMatchingInactive() > 0) {
      <ng-container autocompleteFooter>
        <mat-slide-toggle
          [checked]="includeInactive()"
          (toggleChange)="toggleIncludeInactive()"
          i18n="Label for checkbox|e.g. include inactive children"
          >Also show {{ currentlyMatchingInactive() }} inactive
        </mat-slide-toggle>
      </ng-container>
    }
  </app-basic-autocomplete>

  @if (formControl().enabled) {
    <fa-icon
      icon="caret-down"
      class="form-field-icon-suffix"
      (click)="autocomplete.showAutocomplete()"
    ></fa-icon>
  }
</div>

@if (hasInaccessibleEntities) {
  <div class="hint-text">
    <fa-icon
      icon="warning"
      class="standard-icon-with-text warning-icon"
    ></fa-icon>
    <span i18n
      >Some records are hidden because you do not have permission to access them
      (or they could not be found for other reasons).</span
    >
  </div>
}
