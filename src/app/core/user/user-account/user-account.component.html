<!--
  ~     This file is part of ndb-core.
  ~
  ~     ndb-core is free software: you can redistribute it and/or modify
  ~     it under the terms of the GNU General Public License as published by
  ~     the Free Software Foundation, either version 3 of the License, or
  ~     (at your option) any later version.
  ~
  ~     ndb-core is distributed in the hope that it will be useful,
  ~     but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~     GNU General Public License for more details.
  ~
  ~     You should have received a copy of the GNU General Public License
  ~     along with ndb-core.  If not, see <http://www.gnu.org/licenses/>.
  -->

<mat-tab-group appTabStateMemo>
  <mat-tab i18n-label="User-Account label" label="User Account">
    <div class="margin-top-large width-1-3">
      <p>
        <mat-form-field class="full-width">
          <input
            i18n-placeholder="Username placeholder"
            placeholder="Username"
            matInput="text"
            id="username"
            type="text"
            [value]="username"
            disabled
            class="full-width"
          />
        </mat-form-field>
      </p>

      <form [formGroup]="passwordForm" class="padding-small">
        <div *ngIf="disabledForDemoMode" class="info-field">
          <fa-icon icon="exclamation-circle"></fa-icon>
          <ng-container i18n>
            Password change is not allowed in demo mode.
          </ng-container>
        </div>
        <div *ngIf="disabledForOfflineMode" class="info-field">
          <fa-icon icon="exclamation-circle"></fa-icon>
          <ng-container i18n>
            Password change is not possible while being offline.
          </ng-container>
          <button
            mat-stroked-button
            (click)="checkIfPasswordChangeAllowed()"
            i18n="retry switching from offline to online"
          >
            retry
          </button>
        </div>

        <mat-form-field class="full-width">
          <label i18n>
            Current Password
            <input
              class="full-width"
              matInput
              type="password"
              formControlName="currentPassword"
            />
          </label>
          <mat-error
            *ngIf="passwordForm.get('currentPassword').invalid"
            i18n="
              Password Confirmation|An incorrect password was entered trying
              to change the password
            "
          >
            Please provide your correct current password for confirmation.
          </mat-error>
        </mat-form-field>

        <mat-form-field class="full-width">
          <label i18n>
            New password
            <input matInput type="password" formControlName="newPassword" class="full-width"/>
          </label>
          <mat-error
            *ngIf="passwordForm.hasError('minlength', 'newPassword')"
            i18n="Password validation">
            Must be at least 8 characters long.
          </mat-error>
          <mat-error
            *ngIf="passwordForm.hasError('pattern', 'newPassword')"
            i18n="Password validation">
            Must contain lower case letters, upper case letters, symbols and
            numbers to be secure.
          </mat-error>
        </mat-form-field>
        <br/>

        <mat-form-field class="full-width">
          <label i18n>
            Confirm new password
            <input
              matInput
              class="full-width"
              type="password"
              formControlName="confirmPassword"
            />
          </label>
          <mat-error
            *ngIf="
              passwordForm.get('confirmPassword').invalid &&
              passwordForm.get('confirmPassword').touched
            "
            i18n="Illegal new password"
          >
            Confirmation does not match your new password.
          </mat-error>
        </mat-form-field>
        <br/>

        <div *ngIf="passwordChangeResult">
          <div
            *ngIf="passwordChangeResult.success"
            class="info-field background-success"
            i18n
          >
            Password changed successfully.
          </div>
          <div
            *ngIf="!passwordChangeResult.success"
            class="info-field background-error"
            i18n
          >
            Failed to change password: {{ passwordChangeResult.error }}<br/>
            Please try again. If the problem persists contact Aam Digital
            support.
          </div>
        </div>

        <button
          mat-raised-button
          type="submit"
          [disabled]="passwordForm.invalid || passwordForm.disabled"
          (click)="changePassword()"
          (submit)="changePassword()"
          i18n="Change password button"
        >
          Change Password
        </button>
      </form>
    </div>
  </mat-tab>
</mat-tab-group>
