<h1>Children List</h1>

<mat-expansion-panel expanded="true" fxLayout="column" fxLayoutGap="10px" class='filter-panel'>
  <div fxLayout="row" fxLayoutGap="10px" fxLayoutAlign="none end">
    <div fxFlex='50'>
      <mat-form-field style='width:100%'>
        <input matInput placeholder="Filter" (ngModelChange)="applyFilter($event)" [(ngModel)]="filterString">
        <button mat-icon-button *ngIf="filterString" matSuffix aria-label="Clear" (click)="filterString=''; applyFilter('');">
          <mat-icon fontIcon="fa-times"></mat-icon>
        </button>
      </mat-form-field>
    </div>

    <div class='align-form-field'>
      (Showing {{childrenDataSource.filteredData.length}} children)
    </div>

    <div class='align-form-field'>
      <button mat-stroked-button color="accent" (click)="addChildClick()">
        <mat-icon class="button-icon" aria-label="add child" fontIcon="fa-plus-circle"></mat-icon>Add New Child
      </button>
    </div>
  </div>

  <div fxLayout='row' fxLayoutGap='10px' class="filter-button">
    <mat-button-toggle-group name="columnSelection" [(value)]="columnGroupSelection">
      <!--<mat-button-toggle value="basic" (click)="displayColumnGroup('basic')">Basic Info</mat-button-toggle>-->
      <!--<mat-button-toggle value="school" (click)="displayColumnGroup('school')">School Info</mat-button-toggle>-->
      <!--<mat-button-toggle value="status" (click)="displayColumnGroup('status')">Status</mat-button-toggle>-->
      <!--<mat-button-toggle value="health" (click)="displayColumnGroup('health')">Health</mat-button-toggle>-->
      <mat-button-toggle *ngFor="let item of columnGroups | keyvalue" [value]="item.key"
                         [class.selected]="item.key === columnGroupSelection"
                         (click)="displayColumnGroup(item.key)">
        {{item.key}}
      </mat-button-toggle>
    </mat-button-toggle-group>

    <mat-button-toggle-group *ngFor='let filterSelection of filterSelections'
      [name]="filterSelection.name" [value]='filterSelection.selectedOption'>
      <mat-button-toggle *ngFor='let option of filterSelection.options' [value]="option.key"
                         [class.selected]="option.key === filterSelection.selectedOption"
                         (click)="filterSelection.selectedOption=option.key; applyFilterSelections();">
        {{option.label}}
      </mat-button-toggle>
    </mat-button-toggle-group>
  </div>
</mat-expansion-panel>

<!--<mat-divider></mat-divider>-->

<table mat-table [dataSource]="childrenDataSource" matSort class="mat-elevation-z8 table-list">
  <ng-container matColumnDef="projectNumber">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> PN </th>
    <td mat-cell *matCellDef="let child"> {{child.getProjectNumber()}}</td>
  </ng-container>

  <ng-container matColumnDef="name">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Name </th>
    <td mat-cell *matCellDef="let child"> <app-child-block [entity]='child'></app-child-block> </td>
  </ng-container>

  <ng-container matColumnDef="age">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Age </th>
    <td mat-cell *matCellDef="let child"> {{child.getAge()}} </td>
  </ng-container>

  <ng-container matColumnDef="dateOfBirth">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> DoB </th>
    <td mat-cell *matCellDef="let child"> {{child.getDateOfBirth() | date:'longDate'}} </td>
  </ng-container>

  <ng-container matColumnDef="gender">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Gender </th>
    <td mat-cell *matCellDef="let child"> {{child.getGender()}} </td>
  </ng-container>


  <ng-container matColumnDef="schoolClass">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Class </th>
    <td mat-cell *matCellDef="let child"> {{child.getSchoolClass()}} </td>
  </ng-container>

  <ng-container matColumnDef="schoolId">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> School </th>
    <td mat-cell *matCellDef="let child"><app-school-block [entityId]='child.getSchoolId()'></app-school-block> </td>
  </ng-container>

  <ng-container matColumnDef="attendance-school">
    <th mat-header-cell *matHeaderCellDef> Attendance (School)</th>
    <td mat-cell *matCellDef="let child">
      <app-attendance-block *ngFor="let att of attendanceList.get(child.getId()) | filterBy: {'institution': 'school'} | slice:0:5"
                            [attendanceData]="att"></app-attendance-block>
    </td>
  </ng-container>

  <ng-container matColumnDef="attendance-coaching">
    <th mat-header-cell *matHeaderCellDef> Attendance (Coaching)</th>
    <td mat-cell *matCellDef="let child">
      <app-attendance-block *ngFor="let att of attendanceList.get(child.getId()) | filterBy: {'institution': 'coaching'} | slice:0:5"
                            [attendanceData]="att"></app-attendance-block>
    </td>
  </ng-container>

  <ng-container matColumnDef="center">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Center </th>
    <td mat-cell *matCellDef="let child"> {{child.getCenter()}} </td>
  </ng-container>

  <ng-container matColumnDef="status">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Status </th>
    <td mat-cell *matCellDef="let child"> {{child.getStatus()}} </td>
  </ng-container>

  <ng-container matColumnDef="admissionDate">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Admission </th>
    <td mat-cell *matCellDef="let child"> {{child.getAdmissionDate()}} </td>
  </ng-container>

  <ng-container matColumnDef="motherTongue">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Mother Tongue </th>
    <td mat-cell *matCellDef="let child"> {{child.getMotherTongue()}} </td>
  </ng-container>


  <ng-container matColumnDef="has_aadhar">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Aadhar </th>
    <td mat-cell *matCellDef="let child"> {{child.getHasAadhar()}}</td>
  </ng-container>

  <ng-container matColumnDef="has_bankAccount">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Bank Account </th>
    <td mat-cell *matCellDef="let child"> {{child.getHasBankaccount()}}</td>
  </ng-container>

  <ng-container matColumnDef="has_kanyashree">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Kanyashree </th>
    <td mat-cell *matCellDef="let child"> {{child.getHasKanyashree()}}</td>
  </ng-container>

  <ng-container matColumnDef="has_rationCard">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Ration Card </th>
    <td mat-cell *matCellDef="let child"> {{child.getHasRationCard()}}</td>
  </ng-container>

  <ng-container matColumnDef="has_bplCard">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> BPL Card </th>
    <td mat-cell *matCellDef="let child"> {{child.getHasBplCard()}}</td>
  </ng-container>


  <ng-container matColumnDef="health_vaccinationStatus">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Vaccination Status </th>
    <td mat-cell *matCellDef="let child"> {{child.getHealthVaccinationStatus()}} </td>
  </ng-container>

  <ng-container matColumnDef="health_LastDentalCheckup">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Last Dental Check-Ups </th>
    <td mat-cell *matCellDef="let child"> {{child.health_lastDentalCheckup}} </td>
  </ng-container>

  <ng-container matColumnDef="health_LastEyeCheckup">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Last Eye Check-Up </th>
    <td mat-cell *matCellDef="let child"> {{child.getHealthLastEyeCheckup()}} </td>
  </ng-container>

  <ng-container matColumnDef="health_eyeHealthStatus">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Eye Status </th>
    <td mat-cell *matCellDef="let child"> {{child.getHealthEyeHealthStatus()}} </td>
  </ng-container>

  <ng-container matColumnDef="health_LastENTCheckup">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Last ENT Check-Up </th>
    <td mat-cell *matCellDef="let child"> {{child.getHealthLastEntCheckup()}} </td>
  </ng-container>

  <ng-container matColumnDef="health_LastVitaminD">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Last Vitamin D </th>
    <td mat-cell *matCellDef="let child"> {{child.getHealthLastVitaminD()}} </td>
  </ng-container>

  <ng-container matColumnDef="health_LastDeworming">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Last De-Worming </th>
    <td mat-cell *matCellDef="let child"> {{child.getHealthLastDeworming()}} </td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="columnsToDisplay"></tr>
  <tr mat-row *matRowDef="let child; columns: columnsToDisplay" (click)="showChildDetails(child)"
      style="cursor:pointer;" class="table-list-item"></tr>
</table>
