<h1>Children List</h1>

<mat-expansion-panel expanded="true" fxLayout="column" fxLayoutGap="10px" class='filter-panel'>
  <div fxLayout="row" fxLayoutGap="10px" fxLayoutAlign="none end">
    <div fxFlex='50'>
      <mat-form-field style='width:100%'>
        <input matInput placeholder="Filter" (ngModelChange)="applyFilter($event)" [(ngModel)]="filterString">
        <button mat-icon-button *ngIf="filterString" matSuffix aria-label="Clear" (click)="filterString=''; applyFilter('');">
          <mat-icon fontIcon="fa-times"></mat-icon>
        </button>
      </mat-form-field>
    </div>

    <div class='align-form-field'>
      (Showing {{childrenDataSource.filteredData.length}} children)
    </div>

    <div class='align-form-field'>
      <button mat-stroked-button color="accent" (click)="addChildClick()">
        <mat-icon class="button-icon" aria-label="add child" fontIcon="fa-plus-circle"></mat-icon>Add New Child
      </button>
    </div>
  </div>

  <div fxLayout='row' fxLayoutGap='10px'>
    <mat-button-toggle-group name="columnSelection" [(value)]="columnGroupSelection">
      <mat-button-toggle value="basic" (click)="displayColumnGroup('basic')">Basic Info</mat-button-toggle>
      <mat-button-toggle value="school" (click)="displayColumnGroup('school')">School Info</mat-button-toggle>
      <mat-button-toggle value="status" (click)="displayColumnGroup('status')">Status</mat-button-toggle>
      <mat-button-toggle value="health" (click)="displayColumnGroup('health')">Health</mat-button-toggle>
    </mat-button-toggle-group>

    <mat-button-toggle-group *ngFor='let filterSelection of filterSelections'
      [name]="filterSelection.name" [value]='filterSelection.selectedOption'>
      <mat-button-toggle *ngFor='let option of filterSelection.options' [value]="option.key"
                         (click)='filterSelection.selectedOption=option.key; updateFilterSelections();'>
        {{option.label}}
      </mat-button-toggle>
    </mat-button-toggle-group>
  </div>
</mat-expansion-panel>


<table mat-table [dataSource]="childrenDataSource" matSort class="mat-elevation-z8 table-list">
  <ng-container matColumnDef="projectNumber">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> PN </th>
    <td mat-cell *matCellDef="let child"> {{child.projectNumber}}</td>
  </ng-container>

  <ng-container matColumnDef="name">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Name </th>
    <td mat-cell *matCellDef="let child"> <app-child-block [entity]='child'></app-child-block> </td>
  </ng-container>

  <ng-container matColumnDef="age">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Age </th>
    <td mat-cell *matCellDef="let child"> {{child.getAge()}} </td>
  </ng-container>

  <ng-container matColumnDef="dateOfBirth">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> DoB </th>
    <td mat-cell *matCellDef="let child"> {{child.dateOfBirth}} </td>
  </ng-container>

  <ng-container matColumnDef="gender">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Gender </th>
    <td mat-cell *matCellDef="let child"> {{child.gender}} </td>
  </ng-container>


  <ng-container matColumnDef="class">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Class </th>
    <td mat-cell *matCellDef="let child"> {{child.schoolClass}} </td>
  </ng-container>

  <ng-container matColumnDef="school">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> School </th>
    <td mat-cell *matCellDef="let child"> {{child.schoolName}} </td>
  </ng-container>

  <ng-container matColumnDef="attendance-school">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Attendance (School)</th>
    <td mat-cell *matCellDef="let child">
      <app-attendance-block *ngFor="let att of attendanceList.get(child.getId()) | filterBy: {'institution': 'school'} | slice:0:5"
                            [attendanceData]="att"></app-attendance-block>
    </td>
  </ng-container>

  <ng-container matColumnDef="attendance-coaching">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Attendance (Coaching)</th>
    <td mat-cell *matCellDef="let child">
      <app-attendance-block *ngFor="let att of attendanceList.get(child.getId()) | filterBy: {'institution': 'coaching'} | slice:0:5"
                            [attendanceData]="att"></app-attendance-block>
    </td>
  </ng-container>


  <ng-container matColumnDef="center">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Center </th>
    <td mat-cell *matCellDef="let child"> {{child.center}} </td>
  </ng-container>

  <ng-container matColumnDef="status">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Status </th>
    <td mat-cell *matCellDef="let child"> {{child.status}} </td>
  </ng-container>

  <ng-container matColumnDef="admission">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Admission </th>
    <td mat-cell *matCellDef="let child"> {{child.admissionDate}} </td>
  </ng-container>

  <ng-container matColumnDef="motherTongue">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Mother Tongue </th>
    <td mat-cell *matCellDef="let child"> {{child.motherTongue}} </td>
  </ng-container>

  <ng-container matColumnDef="aadhar">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Aadhar </th>
    <td mat-cell *matCellDef="let child"> {{child.aadhar}} </td>
  </ng-container>


  <ng-container matColumnDef="vaccination">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Vaccination Status </th>
    <td mat-cell *matCellDef="let child"> {{child.health_vaccinationStatus}} </td>
  </ng-container>

  <ng-container matColumnDef="dentalCheckup">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Last Dental Check-Ups </th>
    <td mat-cell *matCellDef="let child"> {{child.health_lastDentalCheckup}} </td>
  </ng-container>

  <ng-container matColumnDef="eyeCheckup">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Last Eye Check-Up </th>
    <td mat-cell *matCellDef="let child"> {{child.health_lastEyeCheckup}} </td>
  </ng-container>

  <ng-container matColumnDef="eyeStatus">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Eye Status </th>
    <td mat-cell *matCellDef="let child"> {{child.health_eyeHealthStatus}} </td>
  </ng-container>

  <ng-container matColumnDef="EntCheckup">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Last ENT Check-Up </th>
    <td mat-cell *matCellDef="let child"> {{child.health_lastENTCheckup}} </td>
  </ng-container>

  <ng-container matColumnDef="vitaminD">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Last Vitamin D </th>
    <td mat-cell *matCellDef="let child"> {{child.health_lastVitaminD}} </td>
  </ng-container>

  <ng-container matColumnDef="deworming">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Last De-Worming </th>
    <td mat-cell *matCellDef="let child"> {{child.health_lastDeworming}} </td>
  </ng-container>



  <tr mat-header-row *matHeaderRowDef="columnsToDisplay"></tr>
  <tr mat-row *matRowDef="let child; columns: columnsToDisplay" (click)="showChildDetails(child)" style="cursor:pointer;"></tr>
</table>
