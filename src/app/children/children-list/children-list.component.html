<h1>Children List</h1>

<mat-expansion-panel expanded="true" fxLayout="column" fxLayoutGap="10px" class='filter-panel'>
  <div fxLayout="row" fxLayoutGap="10px" fxLayoutAlign="none end">
    <div fxFlex='50'>
      <mat-form-field style='width:100%'>
        <input matInput placeholder="Filter" (ngModelChange)="applyFilter($event)" [(ngModel)]="filterString">
        <button mat-icon-button *ngIf="filterString" matSuffix aria-label="Clear" (click)="filterString=''; applyFilter('');">
          <mat-icon fontIcon="fa-times"></mat-icon>
        </button>
      </mat-form-field>
    </div>

    <div class='align-form-field'>
      (Showing {{childrenDataSource.filteredData.length}} children)
    </div>

    <div class='align-form-field'>
      <button mat-stroked-button color="accent" (click)="addChildClick()">
        <mat-icon class="button-icon" aria-label="add child" fontIcon="fa-plus-circle"></mat-icon>Add New Child
      </button>
    </div>
  </div>

  <div fxLayout='row' fxLayoutGap='10px'>
    <mat-button-toggle-group name="columnSelection" [(value)]="columnGroupSelection">
      <mat-button-toggle value="basic" (click)="displayColumnGroup('basic')">Basic Info</mat-button-toggle>
      <mat-button-toggle value="school" (click)="displayColumnGroup('school')">School Info</mat-button-toggle>
      <mat-button-toggle value="status" (click)="displayColumnGroup('status')">Status</mat-button-toggle>
    </mat-button-toggle-group>

    <mat-button-toggle-group name="dropoutFilterSelection" [(value)]="dropoutFilterSelection">
      <mat-button-toggle value="current" (click)="setDropoutFilteredList('current')">Current Project Children</mat-button-toggle>
      <mat-button-toggle value="dropouts" (click)="setDropoutFilteredList('dropouts')">Dropouts</mat-button-toggle>
      <mat-button-toggle value="" (click)="setDropoutFilteredList('')">All</mat-button-toggle>
    </mat-button-toggle-group>

    <mat-button-toggle-group name="centerFilterSelection" [(value)]="centerFilterSelection">
      <mat-button-toggle *ngFor='let center of centers' [value]="center" (click)="setCenterFilteredList(center)">{{center}}</mat-button-toggle>
      <mat-button-toggle value="" (click)="setCenterFilteredList('')">All</mat-button-toggle>
    </mat-button-toggle-group>
  </div>
</mat-expansion-panel>


<table mat-table [dataSource]="childrenDataSource" matSort class="mat-elevation-z8 table-list" width='100%'>
  <ng-container matColumnDef="pn">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> PN </th>
    <td mat-cell *matCellDef="let child"> {{child.pn}} </td>
  </ng-container>

  <ng-container matColumnDef="name">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Name </th>
    <td mat-cell *matCellDef="let child"> {{child.name}} </td>
  </ng-container>

  <ng-container matColumnDef="age">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Age </th>
    <td mat-cell *matCellDef="let child"> {{child.getAge()}} </td>
  </ng-container>

  <ng-container matColumnDef="class">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Class </th>
    <td mat-cell *matCellDef="let child"> {{child.grade}} </td>
  </ng-container>

  <ng-container matColumnDef="school">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> School </th>
    <td mat-cell *matCellDef="let child"> {{child.school}} </td>
  </ng-container>

  <ng-container matColumnDef="center">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Center </th>
    <td mat-cell *matCellDef="let child"> {{child.center}} </td>
  </ng-container>

  <ng-container matColumnDef="status">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Status </th>
    <td mat-cell *matCellDef="let child"> {{child.status}} </td>
  </ng-container>

  <ng-container matColumnDef="attendance">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Attendance </th>
    <td mat-cell *matCellDef="let child">
      <app-attendance-block *ngFor="let att of attendanceList.get(child.pn)" [attendanceData]="att"></app-attendance-block>
    </td>
  </ng-container>


  <tr mat-header-row *matHeaderRowDef="columnsToDisplay"></tr>
  <tr mat-row *matRowDef="let child; columns: columnsToDisplay" (click)="showChildDetails(child)" style="cursor:pointer;"></tr>
</table>
